<link rel="import" href="../../bower_components/polymer/polymer.html" />

<script>

  (function(){
    "use-strict";
    /*
    @polymerBehavior Polymer.notificationBehavior
    */
    Polymer.notificationBehavior = {
      is:"notification-behavior",

      ready:function(){
        this.addEventListener('dismissNotification',this.dismissNotification);
        this.addEventListener('checkNotification', this.checkNotification);
      },

      properties:{

      },

      observers:[
        '_computeNotificationCount(notifiesData)',
        '_computeNotifyDialogHidden(notifiesData.*)',
      ],

      _computeNotificationCount:function(notifiesData){
        var count;
        this.$.notifyDB.query
          .on("value",function(snapshot){
            count=snapshot.numChildren();
            this.notifyCount=count;
          }.bind(this));
      },

      _computeNotifyDialogHidden:function(count){
        if(count.base.length<1){
          this.$.notifyDialog.close();
          this.$.notifyCount.style="opacity:0;";
        } else {
          this.$.notifyCount.style="opacity:1;";
        };
      },

      dismissNotification:function(e){
        var key = e.detail.data.$key;
        var data = e.detail.data;
        var index = e.detail.index;
        delete data.$key;
        this.$.notifiableDB.path=null;
        this.$.notifiableDB.data=data;
        this.$.notifiableDB.save("/homes/"+this.home+"/notifications/notified", key)
          .then(function(){
            this.$.notifiableDB.path="/homes/"+this.home+"/notifications/notify/"+key;
            this.$.notifiableDB.destroy()
              .then(function(){
                this.notifyPath("notifiesData");
              }.bind(this));
          }.bind(this));
      },

      _computeNotifyHidden:function(count){
        if(count<1){
          return true;
        } else {
          return false;
        }
      },

    };

  })();

</script>
