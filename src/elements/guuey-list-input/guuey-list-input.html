<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-input/paper-textarea.html" />
<link rel="import" href="../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../bower_components/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../bower_components/iron-media-query/iron-media-query.html" />

<dom-module id="guuey-list-input">

  <iron-media-query
    query="(max-width:1600px)"
    query-matches="{{query1600}}">
  </iron-media-query>

  <iron-media-query
    query="(max-width:1400px)"
    query-matches="{{query1400}}">
  </iron-media-query>

  <iron-media-query
    query="(max-width:1200px)"
    query-matches="{{query1200}}">
  </iron-media-query>

  <iron-media-query
    query="(max-width:1000px)"
    query-matches="{{query1000}}">
  </iron-media-query>

  <iron-media-query
    query="(max-width:800px)"
    query-matches="{{query800}}">
  </iron-media-query>

  <iron-media-query
    query="(max-width:600px)"
    query-matches="{{query600}}">
  </iron-media-query>

  <style>

    .sectionHeading{
      background-color:#42c6ff;
      width:100%;
      /*
      min-height:var(--guuey-list-min-header-height);
      */
    }
    .sectionHeadingText{
      font-size: 24px;
      color:#FFFFFF;
      margin:0px;
      padding:20px 20px 0px 20px;
      font-size:var(--heading-font-size);
    }
    .subHeadingText{
      color:#FFFFFF;
      margin:0px;
      padding:20px;
      font-size:var(--sub-heading-font-size);
      padding:0px 20px 20px 20px;
    }
    .customContainer{
      padding:16px;
    }
    paper-card{
      width:90%;
      margin:20px 5% 20px 5%;
    }
    paper-card{
      width: var(--guuey-list-width);
      float: var(--guuey-list-float);
      min-height:var(--guuey-list-min-height);
    }
    .editLeft{
      display:inline-block;
      width:50%;
      margin:0;
    };
    editRight{
      display:inline-block;
      width:50%;
      margin:0;
    }
    .editArea{
      background-color:rgba(106, 73, 178, 0.2);
      padding:16px;
    }

  </style>

  <template>

    <paper-card>

      <div class="sectionHeading">
        <div class="customContainer">
          <p class="sectionHeadingText">[[label]]</p>
          <p class="subHeadingText">[[label2]]</p>
        </div>
      </div>

      <div class="customContainer">
        <template
          is="dom-repeat"
          items="{{_computeArray(value)}}"
          sort="sortByOrder"
          observe="order entry">

          <paper-textarea on-input="entryChanged" label="entry" value="{{item.entry}}"></paper-textarea>

          <div class="editArea" hidden="[[!editing]]">

            <vaadin-combo-box
              class="editLeft"
              on-change="orderChanged"
              label="Order"
              items="{{_computeOrderRange(arrayCount)}}"
              value="{{item.order}}">
            </vaadin-combo-box>

            <paper-button class="editRight" on-tap="delete">delete</paper-button>

          </div>

        </template>
        <paper-textarea label="entry" value="{{newEntry}}"></paper-textarea>
        <paper-button hidden$="[[!editing]]" on-tap="stopEdit">stop editing</paper-button>
        <paper-button hidden$="[[editing]]" on-tap="edit">edit</paper-button>
        <paper-button on-tap="saveNewEntry">add</paper-button>

      </template>
      </div>

    </paper-card>

  <script>

    Polymer({
      is:"guuey-list-input",
      properties:{
        value:{
          type:Object,
          notify:true
        },
        arrayCount:{
          type:Number,
          value:0
        },
        editing:{
          type:Boolean,
          value:false
        }
      },
      observers:[
        "editQuery(query1600, query1400, query1200, query1000, query800, query600)"
      ],
      _computeArray:function(value){
        var computedArray=[];
        var arrayCount=0;
        for(x in value){
          var entryObj={
            entry:value[x].entry,
            order:value[x].order
          };
          computedArray.push(value[x]);
          arrayCount++;
        };
        this.arrayCount=arrayCount;
        return computedArray;
      },
      saveNewEntry:function(){
        if(!this.value){
          var initVal={};
          this.set("value",initVal);
        };
        var uid=new Date().valueOf();
        var entryCount=this.arrayCount+1;
        var newEntryObj={
          entry:this.newEntry,
          order:this.arrayCount+1,
          uid:uid
        };
        this.set("value."+"entry"+uid, newEntryObj);
        this.newEntry=null;
      },
      entryChanged:function(e){
        if(e.model.item){
          this.set("value."+"entry"+e.model.item.uid+".entry", e.model.item.entry);
        };
      },
      orderChanged:function(e){
        if(e.model.item){
          this.set("value."+"entry"+e.model.item.uid+".order", e.model.item.order);
        };
      },
      edit:function(){
        this.editing=true;
      },
      stopEdit:function(){
        this.editing=false;
      },
      delete:function(e){
        var key="entry"+e.model.item.uid;
        this.set("value."+key, null);
      },
      _computeOrderRange:function(count){
        var orderArray=[];
        for(i=1; i<=count+1; i++){
          var order=i.toString();
          orderArray.push(order);
        };
        return orderArray;
      },
      sortByOrder:function(a,b){
        return a.order>b.order;
      },
      editQuery:function(query1600, query1400, query1200, query1000, query800, query600){
        if(query600){
          this.customStyle["--heading-font-size"]="12px";
          this.updateStyles();
        } else if(query800){
          this.customStyle["--heading-font-size"]="14px";
          this.updateStyles();
        } else if(query1000){
          this.customStyle["--heading-font-size"]="16px";
          this.updateStyles();
        } else if(query1200){
          this.customStyle["--heading-font-size"]="18px";
          this.updateStyles();
        } else if(query1400){
          this.customStyle["--heading-font-size"]="20px";
          this.updateStyles();
        } else if(query1600){
          this.customStyle["--heading-font-size"]="22px";
          this.updateStyles();
        } else {
          this.customStyle["--heading-font-size"]="24px";

          this.updateStyles();
        }
      }
    });

  </script>

</dom-module>
