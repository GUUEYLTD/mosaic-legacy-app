<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-time-picker/paper-time-picker.html" />
<link rel="import" href="../../../bower_components/polymerfire/firebase-document.html" />
<link rel="import" href="../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html" />
<link rel="import" href="../../../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html" />

<dom-module id="guuey-time-input">
  <template>

    <firebase-document
      id="timeDB"
      app-name="main"
      path="[[route]]"
      data="{{timeDatalive}}">
    </firebase-document>

    <app-indexeddb-mirror
      key="timeDB|[[route]]"
      data="{{timeDatalive}}"
      persisted-data="{{timeData}}"
      worker-url="../../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <style>
      .sectionHeading{
        background-color:#42c6ff;
        width:100%;
        margin:0px !important;
        padding:0px;
      }
      .sectionHeadingText{
        font-size: 24px;
        color:#FFFFFF;
        margin:0px;
        padding:20px;
      }
      .subHeadingText{
        color:#FFFFFF;
        margin:0px;
        padding:20px;
      }
      .inputWrapper{
        padding:16px;
      }
      paper-card{
        width:90%;
        margin:20px 5% 20px 5%;
      }
      .toggleButton{
        padding-top:50px;
      }
    </style>
    <paper-dialog id="timeDialog">
      <paper-time-picker id="papertime" time={{time}}></paper-time-picker>
    </paper-dialog>

    <paper-input
      on-tap="enterTime"
      label="[[label]]"
      value="{{_computeTime(timeData)}}">
    </paper-input>

  </template>

  <script>

    Polymer({
      is:'guuey-time-input',
      properties:{
        route:{
          type:String,
        },
        time:{
          observer:"_timeChanged",
          type:Object
        },
        label:{
          type:String
        }
      },
      enterTime:function(){
        this.$.timeDialog.toggle();
        this.timeEdit=true;
      },
      _timeChanged:function(){
        if(this.timeEdit){
          this.stringtime=this.time.toString();
          this.$.timeDB.setStoredValue(this.route, this.stringtime);
        }
      },
      _computeTime:function(time){
        if(typeof time==="string"){
          return time.slice(3,15);
        } else {
          return null;
        };
      }
    });

  </script>
</dom-module>
