<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/polymerfire/firebase-app.html" />
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html" />
<link rel="import" href="../bower_components/polymerfire/firebase-document.html" />
<link rel="import" href="../bower_components/polymerfire/firebase-query.html" />
<link rel="import" href="../bower_components/polymerfire/firebase-messaging.html" />
<link rel="import" href="../bower_components/app-route/app-location.html" />
<link rel="import" href="../bower_components/app-route/app-route.html" />
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html" />
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html" />
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html" />
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html" />
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../bower_components/paper-badge/paper-badge.html" />
<link rel="import" href="../bower_components/iron-pages/iron-pages.html" />
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html" />
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="../bower_components/paper-item/paper-item.html" />
<link rel="import" href="../bower_components/paper-item/paper-item-body.html" />
<link rel="import" href="../bower_components/iron-selector/iron-selector.html" />
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html" />
<link rel="import" href="../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../bower_components/iron-icons/social-icons.html" />
<link rel="import" href="../bower_components/iron-icons/hardware-icons.html" />
<link rel="import" href="../bower_components/paper-toast/paper-toast.html" />
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html" />
<link rel="import" href="../bower_components/paper-progress/paper-progress.html" />
<link rel="import" href="../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html" />
<link rel="import" href="../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html" />
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html" />
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html" />
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html" />
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html" />
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html" />
<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html" />
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html" />

<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-from-left-animation.html">

<link rel="import" href="elements/admin-drawer/admin-drawer.html" />
<link rel="import" href="elements/guuey-bug-report/guuey-bug-report.html" />
<link rel="import" href="elements/media-queries/media-queries.html" />
<link rel="import" href="elements/guuey-notification/guuey-notification.html" />
<link rel="import" href="elements/guuey-account-display/guuey-account-display.html" />
<!--account function dialogs-->
<link rel="import" href="elements/guuey-login/guuey-login.html" />
<link rel="import" href="elements/guuey-verify/guuey-verify.html" />
<link rel="import" href="elements/guuey-agree-terms/guuey-agree-terms.html" />

<link rel="import" href="behaviors/shell-resize-behavior.html" />
<link rel="import" href="behaviors/page-change-middleware.html" />
<link rel="import" href="behaviors/account-create-behavior.html" />
<link rel="import" href="behaviors/push-notification-behavior.html" />
<link rel="import" href="behaviors/payment-check-behavior.html" />
<link rel="import" href="behaviors/sign-in-behavior.html" />
<link rel="import" href="behaviors/notification-behavior.html" />

<link rel="import" href="styles/app-shell-styles.html" />

<link rel="import" href="icons/custom-icons.html" />
<link rel="import" href="icons/module-icons.html" />


<dom-module id="my-app">

  <template>

    <media-queries
      dimensions="{{dimensions}}">
    </media-queries>

    <iron-localstorage
      id="recentUsers"
      name="recent-users"
      on-iron-localstorage-load-empty="_initializeRecentUsers">
    </iron-localstorage>

    <iron-localstorage
      id="deviceNames"
      name="device-names"
      value="{{deviceNames}}"
      on-iron-localstorage-load-empty="_initializeDeviceNames">
    </iron-localstorage>

    <iron-localstorage
      id="appVersion"
      name="app-version"
      value="{{appVersion}}"
      on-iron-localstorage-load-empty="_initializeAppVersion">
    </iron-localstorage>

    <!--firebase app and auth config-->
    <firebase-app
      name="main"
      auth-domain="mosaic-dev-b7ffe.firebaseapp.com"
      database-url="https://mosaic-dev-b7ffe.firebaseio.com"
      api-key="AIzaSyDDsDCie-Fy_zDDMW7bCNF5alEOx-SxbrU"
      storage-bucket="mosaic-dev-b7ffe.appspot.com"
      messaging-sender-id="841971867726">
    </firebase-app>

    <firebase-auth
      id="auth"
      online="{{online}}"
      app-name="main"
      user="{{user}}"
      signed-in="{{signedIn}}"
      status-known="{{statusKnown}}"
      on-error="handleError">
    </firebase-auth>

    <app-indexeddb-mirror
      id="userSettingsMirror"
      key="homeDetailsDB"
      session="[[userUid]]"
      data="{{careHomeProfileLive}}"
      persisted-data="{{careHomeProfile}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <!--SAME AS ABOVE MOVE LATER USED TO GET PROFILE INFO FOR SIDEBAR-->
    <firebase-document
      id="homeDetailsDB"
      path="/homes/[[home]]/details"
      data="{{careHomeProfileLive}}"
      app-name="main">
    </firebase-document>

    <app-indexeddb-mirror
      id="userInfoMirror"
      session="[[userUid]]"
      key="userInfoDB"
      data="{{userInfoDataLive}}"
      persisted-data="{{userInfoData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="userInfoDB"
      path="/homes/[[home]]/users/[[user.uid]]"
      data="{{userInfoDataLive}}"
      app-name="main">
    </firebase-document>

    <app-indexeddb-mirror
      id="userSettingsMirror"
      session="[[userUid]]"
      key="settingsDB"
      data="{{settingsDataLive}}"
      persisted-data="{{settingsData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="settingsDB"
      app-name="main"
      data="{{settingsDataLive}}">
    </firebase-document>

    <app-indexeddb-mirror
      id="appInfoMirror"
      session="[[userUid]]"
      key="appInfoDB"
      data="{{appInfoDataLive}}"
      persisted-data="{{appInfoData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="appInfoDB"
      app-name="main"
      data="{{appInfoDataLive}}"
      path="/appInfo">
    </firebase-document>

    <app-indexeddb-mirror
      id="userSettingsMirror"
      session="[[userUid]]"
      key="userSettingsDB"
      data="{{userSettingsDataLive}}"
      persisted-data="{{userSettingsData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="userSettingsDB"
      app-name="main"
      data="{{userSettingsDataLive}}">
    </firebase-document>

    <app-indexeddb-mirror
      id="notifyMirror"
      session="[[userUid]]"
      key="notifyDB"
      data="{{notifiesDataLive}}"
      persisted-data="{{notifiesData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-query
      id="notifyDB"
      path="/homes/[[home]]/notifications/notify"
      data="{{notifiesDataLive}}"
      app-name="main">
    </firebase-query>

    <app-indexeddb-mirror
      id="suIndexMirror"
      session="[[userUid]]"
      key="suIndexDB"
      data="{{suListLive}}"
      persisted-data="{{suList}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-query
      id="suIndexDB"
      path="/homes/[[home]]/patients/suIndex"
      data="{{suListLive}}"
      app-name="main">
    </firebase-query>

    <app-indexeddb-mirror
      id="paymentsMirror"
      session="[[userUid]]"
      key="paymentsDB"
      data="{{paymentsLive}}"
      persisted-data="{{payments}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-query
      id="paymentsDB"
      app-name="main"
      path="/payments/[[home]]"
      data="{{paymentsLive}}">
    </firebase-query>

    <!--firebase doc to create new home... NEEDS TO GO ELSEWHERE LATER!-->
    <firebase-document
      id="homeDB"
      app-name="main">
    </firebase-document>

    <firebase-document
      id="userIndexDB"
      app-name="main">
    </firebase-document>

    <firebase-document
      id="homeIndexDB"
      app-name="main">
    </firebase-document>

    <firebase-document
      id="notifiableDB"
      app-name="main">
    </firebase-document>

    <!--MOVE THIS WHEN REFACTORING CODE DOES NOT BELONG HERE!-->
    <firebase-document
      id="userDB"
      app-name="main">
    </firebase-document>

    <firebase-document
      id="userTypeDB"
      app-name="main">
    </firebase-document>

    <firebase-document
      id="messagingTokenDB"
      path="/homes/[[home]]/users/[[user.uid]]/messagingTokens/[[currentDevice]]"
      app-name="main"
      data="[[messagingToken]]"
      disabled>
    </firebase-document>

    <firebase-messaging
      id="messaging"
      app-name="main"
      token="{{messagingToken}}"
      active="{{messagingActive}}"
      on-message="_handleMessage">
    </firebase-messaging>

    <!--routing config-->
    <app-location id="location" route="{{route}}"></app-location>

    <!--route to declare which home is being accessed-->
    <app-route
      route="[[route]]"
      pattern="/:home"
      data="{{homeData}}"
      tail="{{catRoute}}">
    </app-route>

    <!--route for page dir (category of page)-->
    <app-route
      route="[[catRoute]]"
      pattern="/:category"
      data="{{catData}}"
      tail="{{pageRoute}}">
    </app-route>

    <!--route for page name-->
    <app-route
      route="[[pageRoute]]"
      pattern="/:page"
      data="{{pageData}}"
      tail="{{patientRoute}}">
    </app-route>

    <!--final param for multi use (patientid, careworkerid etc...)-->
    <app-route
      route="[[patientRoute]]"
      pattern="/:patient"
      data="{{patientData}}"
      tail="{{paramRoute}}">
    </app-route>

    <app-route
      route="[[paramRoute]]"
      pattern="/:param"
      data="{{paramData}}">
    </app-route>

    <style include="app-shell-styles">

    </style>

    <guuey-login
      id="loginDialog"
      modal
      entry-animation="fade-in-animation"
      exit-animation="fade-out-animation">
    </guuey-login>

    <guuey-verify
      id="verifyDialog"
      modal
      home="[[home]]"
      user="[[user]]"
      entry-animation="fade-in-animation"
      exit-animation="fade-out-animation">
    </guuey-verify>

    <guuey-agree-terms
      id="termsDialog"
      modal
      home="[[home]]"
      user="[[user]]"
      user-info-data="{{userInfoData}}"
      entry-animation="fade-in-animation"
      exit-animation="fade-out-animation">
    </guuey-agree-terms>

    <paper-dialog id="overflowDialog">
      <paper-listbox attr-for-selected="name" selected="[[page]]" selected-class="overflow-selected">
        <a class="inherit" name="def-terms" style="text-decoration: none;"  href="/[[home]]/default/def-terms"><paper-item>Terms</paper-item><a>
        <a class="inherit" name="def-policies" style="text-decoration: none;" tabindex="-1" href="/[[home]]/default/def-terms"><paper-item>Policies</paper-item><a>
        <a class="inherit" name="su-incidents" style="text-decoration: none;" tabindex="-1" href="/[[home]]/default/def-terms"><paper-item>Incident Reporting</paper-item><a>
        <a class="inherit" name="ad-support" style="text-decoration: none;" tabindex="-1" href="/[[home]]/admin/ad-support"><paper-item>Support</paper-item><a>
        <guuey-bug-report home="[[home]]" page="[[page]]" patient="[[patient]]" user="[[user]]"></guuey-bug-report>
      </paper-listbox>
    </paper-dialog>

    <paper-dialog id="requestNotificationModal" modal>
      <h2>Permission Needed</h2>
      <p>
        We need your permission to send push notifications to your current device. Click Proceed to continue.
      </p>
      <paper-input label="current device name" required value="{{newDevice}}"></paper-input>
      <paper-button on-tap="requestNotificationPermission">proceed</paper-button>

    </paper-dialog>

    <paper-dialog id="movedDialog" modal>
      <h2>app has moved</h2>
      <p>
        please visit <a href="https://app.mosaic-care.com">app.mosaic-care.com</a> to use the app in it's new location. Thanks.
      </p>
    </paper-dialog>

    <paper-dialog id="appsDialog">
      <div class="flexRow">
        <div on-tap="openApp" data-name="carePlan" class="appBox">
          <iron-icon icon="modules:care-plan"></iron-icon>
          <p>
            Care Plan
          </p>
        </div>
        <div on-tap="openApp" data-name="medication" class="appBox">
          <iron-icon icon="modules:medication"></iron-icon>
          <p>
            Medication
          </p>
        </div>
        <div on-tap="openApp" data-name="training" class="appBox">
          <iron-icon icon="modules:training"></iron-icon>
          <p>
            Training
          </p>
        </div>
      </div>
      <div class="flexRow">
        <div on-tap="openApp" data-name="healthSafety" class="appBox">
          <iron-icon icon="modules:health-safety"></iron-icon>
          <p>
            Health & Safety
          </p>
        </div>
        <div on-tap="openApp" data-name="policiesProcedures" class="appBox">
          <iron-icon icon="modules:policies-procedures"></iron-icon>
          <p>
            Policies & Procedures
          </p>
        </div>
        <div on-tap="openApp" data-name="analytics" class="appBox">
          <iron-icon icon="modules:analytics"></iron-icon>
          <p>
            Analytics
          </p>
        </div>
      </div>
      <div class="flexRow">
        <div on-tap="openApp" data-name="communication" class="appBox">
          <iron-icon icon="modules:communication"></iron-icon>
          <p>
            Communication
          </p>
        </div>
        <div on-tap="openApp" data-name="staffManager" class="appBox">
          <iron-icon icon="modules:staff-manager"></iron-icon>
          <p>
            Staff Manager
          </p>
        </div>
        <div on-tap="openApp" data-name="mealPlanning" class="appBox">
          <iron-icon icon="modules:meals"></iron-icon>
          <p>
            Meal Planning
          </p>
        </div>
      </div>
    </paper-dialog>

    <paper-dialog id="appPromoDialog">
      <h2>[[appModuleName]]</h2>
      <p>
        [[appModuleText]]
      </p>
    </paper-dialog>

    <paper-dialog id="notifyDialog">
      <paper-dialog-scrollable id="notifyDialogScroll">

        <template is="dom-repeat" items="[[notifiesData]]" as="guueyNotify">

            <guuey-notification index="[[index]]" info="[[guueyNotify]]"></guuey-notification>

        </template>

      </paper-dialog-scrollable>
    </paper-dialog>

    <paper-dialog id="logoutDialog">
      <guuey-account-display
        user-image="[[_computeUserPhoto(user.photoURL)]]"
        display-name="[[_computeDisplayName(user.displayName)]]"
        user-email="[[user.email]]"
        home="[[home]]"
        on-tap="closeLogout">
      </guuey-account-display>
    </paper-dialog>

    <paper-dialog modal id="lockedDialog">
      <p>
        [[restrictDialogText]]
      </p>
    </paper-dialog>

    <paper-dialog id="searchDialog" style="margin:0px; width:100%;">

      <paper-input label="Search" value="{{searchVal}}"></paper-input>

      <iron-collapse id="searchDropdown">

        <template
          is="dom-repeat"
          items="[[suList]]"
          as="search"
          filter="{{searchFilter(searchVal)}}"
          observe="fName lName"
          initial-count="10">
            <a class="dropdownLinks" href="/[[home]]/care-plan/su-profile/[[search.$key]]" on-tap="hideSearch">
              <paper-item class="dropdownItem">
                <iron-image sizing="contain" src="[[search.image]]" class="searchImage" item-icon></iron-image>
                <p class="searchName">
                  [[search.fName]] [[search.lName]]
                </p>
              </paper-item>
            </a>
        </template>

      </iron-collapse>

    </paper-dialog>

    <paper-dialog id="subMenuDialog"
      style="margin:0; min-width:300px;"
      entry-animation="slide-from-left-animation"
      exit-animation="fade-out-animation">
      <paper-listbox attr-for-selected="name" selected="[[page]]">
        <template is="dom-repeat" items="[[subMenuItems]]" as="subItem">
          <paper-item on-tap="closeSubMenuDialog" class="nav-tabs sub-menu-item" link name="[[subItem.name]]"><a class="sub-menu-href" tabindex="-1" href="/[[home]]/care-plan/[[subItem.name]]/[[patient]]">[[subItem.display]]<a></paper-item>
        </template>
      </paper-listbox>
    </paper-dialog>

    <paper-dialog id="appUpdateDialog">
      <h2>App Update Available</h2>
      <p>
        There is an update available for Mosaic. You can update now or cancel and be reminded later once when you have finished what you are doing.
      </p>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button on-tap="updateApp">Update</paper-button>
      </div>
    </paper-dialog>



    <div class="loadingOverlay">
      <paper-spinner-lite active></paper-spinner-lite>
      <p>
        Just a minute... Content Loading...
      </p>
    </div>
    <div class="loginOverlay"></div>

    <app-drawer-layout fullbleed id="appDrawerLayout">

      <!--admin drawer that contains admin account info and functions-->
      <admin-drawer
        id="adminDrawer"
        home="[[home]]"
        image="[[user.photoURL]]"
        email="[[user.email]]"
        user-type="[[currentUserType]]"
        opened="{{opened}}"
        allowed-pages="[[allowedPages]]"
        user-settings-data="{{userSettingsData}}">
      </admin-drawer>

      <app-header-layout fullbleed>

        <app-header id="appHeader" fixed condenses>

          <app-toolbar id="topNav" class="top-nav">

            <paper-icon-button class="nav-icon-button" icon="menu" on-tap="toggleDrawer"></paper-icon-button>

            <div main-title></div>

            <paper-tabs attr-for-selected="name" selected="{{rightMenuSelect}}">
              <paper-tab class$="[[_computeBackButtonClass(page)]]" name="back" disabled="[[_atHome(page)]]" on-tap="goBack"><iron-icon icon="icons:arrow-back"></iron-icon></paper-tab>
              <paper-tab name="search" on-tap="openSearch"><iron-icon icon="icons:search"></iron-icon></paper-tab>
              <paper-tab id="appButton" name="apps" on-tap="openApps"><iron-icon icon="icons:apps"></iron-icon></paper-tab>
              <paper-tab  id="notifyButton" name="notify" on-tap="openNotifications">
                <iron-icon id="notifyIcon" icon="social:notifications"></iron-icon>
                <paper-badge label="[[notifyCount]]" for="notifyIcon" hidden$="{{_computeNotifyHidden(notifyCount)}}"></paper-badge>
              </paper-tab>
              <paper-tab name="logout" on-tap="openLogout"><iron-icon icon="icons:account-circle"></iron-icon></paper-tab>
              <paper-tab name="overflow" on-tap="openOverflow"><iron-icon icon="icons:more-vert"></iron-icon></paper-tab>
            </paper-tabs>

          </app-toolbar>

          <app-toolbar sticky class="bottom-nav-container">
            <paper-tabs
              style="width:100%;"
              id="bottomNav"
              class="bottom-nav bottom-nav-closed"
              attr-for-selected="name"
              selected="[[page]]"
              scrollable>
              <paper-tab class$="[[_computeSubSelected('profile', page)]]" id="profile" name="profile" on-tap="openProfileSub">PROFILE</paper-tab>
              <paper-tab class$="[[_computeSubSelected('care', page)]]" id="care" name="care" on-tap="openProfileSub">CARE</paper-tab>
              <paper-tab class$="[[_computeSubSelected('reports', page)]]" id="reports" name="reports" on-tap="openProfileSub">REPORTS</paper-tab>
              <paper-tab on-tap="closeSubMenuDialog" class="nav-tabs" link name="su-medication"><a class="menu-link" tabindex="-1" href="/[[home]]/care-plan/su-medication/[[patient]]">Medication</a></paper-tab>
              <paper-tab on-tap="closeSubMenuDialog" class="nav-tabs" link name="su-risk"><a class="menu-link" tabindex="-1" href="/[[home]]/care-plan/su-risk/[[patient]]">Risk Assessment</a></paper-tab>
              <paper-tab on-tap="closeSubMenuDialog" class="nav-tabs" link name="su-goals"><a class="menu-link" tabindex="-1" href="/[[home]]/care-plan/su-goals/[[patient]]">Personal Goals</a></paper-tab>
            </paper-tabs>

            <div id="bottomNavTitle" class="bottom-nav-title">
              <p>
                Mosaic Care
              </p>
            </div>
            <paper-progress bottom-item class="mainProgress" indeterminate></paper-progress>
          </app-toolbar>
        </app-header>

        <!--page templates are loded in here inside iron pages-->
        <neon-animated-pages
          id="neonPages"
          role="main"
          selected="[[selected]]"
          attr-for-selected="name">
          <!--custom pages built for the app names attached in order to know which to display according to route-->
          <!--page selected style only shows when the drawer item has been clicked twice need to fix this..-->
          <!--default page-->
          <def-home
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="def-home"
            signed-in="[[signedIn]]"
            from-login="{{fromLogin}}">
          </def-home>
          <!--default page if not verified-->
          <def-verify
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="def-verify">
          </def-verify>
          <def-account
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="def-account">
          </def-account>

          <def-terms
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="def-terms">
          </def-terms>
          <!--error 404 page-->
          <def-error
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            name="def-error">
          </def-error>
          <!--other pages for care plan-->
          <su-home
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-home">
          </su-home>
          <su-profile
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-profile">
          </su-profile>
          <su-care
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-care">
          </su-care>
          <su-goals
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="{{page}}"
            patient="[[patient]]"
            home="[[home]]"
            name="su-goals"
            param="{{param}}">
          </su-goals>

          <su-goals-edit
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="{{page}}"
            patient="[[patient]]"
            home="[[home]]"
            name="su-goals-edit"
            param="{{param}}">
          </su-goals-edit>
          <!--add in user in order to log the uid for version control and logging-->
          <su-uploads
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            user="{{user}}"
            name="su-uploads">
          </su-uploads>
          <!--add in user in order to log the uid for version control and logging-->
          <su-medication
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            user="{{user}}"
            name="su-medication"
            user-settings-data="[[userSettingsData]]"
            param="[[param]]">
          </su-medication>
          <su-medication-edit
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            user="{{user}}"
            name="su-medication-edit"
            param="[[param]]">
          </su-medication-edit>
          <su-pre
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-pre">
          </su-pre>
          <!--add in user in order to log the uid for version control and logging-->
          <su-risk
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-risk"
            param="[[param]]">
          </su-risk>
          <su-risk-edit
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-risk-edit"
            param="[[param]]">
          </su-risk-edit>
          <su-create
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-create">
          </su-create>
          <su-care-review
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-care-review"
            param="[[param]]">
          </su-care-review>
          <su-care-review-edit
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="{{page}}"
            patient="[[patient]]"
            home="[[home]]"
            name="su-care-review-edit"
            param="{{param}}">
          </su-care-review-edit>
          <su-reports
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-reports">
          </su-reports>
          <su-monthly-reports
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-monthly-reports">
          </su-monthly-reports>
          <su-view-reports
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="su-view-reports">
          </su-view-reports>
          <!--pages for admin-->
          <ad-dash
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-dash">
          </ad-dash>
          <ad-profile
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-profile">
          </ad-profile>
          <ad-payment
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-payment">
          </ad-payment>
          <ad-users
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            user={{user}}
            home="[[home]]"
            name="ad-users">
          </ad-users>
          <ad-settings
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-settings">
          </ad-settings>
          <ad-support
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-support">
          </ad-support>
          <ad-reports
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            home="[[home]]"
            name="ad-reports">
          </ad-reports>
          <!--test page for whatever-->
          <test-test
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="[[page]]"
            patient="[[patient]]"
            home="[[home]]"
            name="test-test">
          </test-test>

          <test-main
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="{{page}}"
            patient="[[patient]]"
            home="[[home]]"
            name="test-main"
            param="{{param}}">
          </test-main>

          <test-edit
            user="[[user]]"
            user-uid="[[userUid]]"
            current-page="[[currentPage]]"
            current-cat="[[currentCat]]"
            intended-cat="[[intendedCat]]"
            page="{{page}}"
            patient="[[patient]]"
            home="[[home]]"
            name="test-edit"
            param="{{param}}">
          </test-edit>

        </neon-animated-pages>

      </app-header-layout>

    </app-drawer-layout>

    <paper-toast
      id="mainToast"
      class="fit-bottom"
      duration="15000">
      <a style="color:yellow;" hidden$=[[termsHidden]] href="/[[home]]/default/def-terms">See Terms</a>
      <paper-button on-tap="closeToast">close</paper-button>
    </paper-toast>

  </template>

  <script>

    Polymer({

      is:'my-app',

      properties: {

        online: {
          type: Boolean,
          observer: "_onlineChanged"
        },

        rightMenuSelect: {
          type: String,
          value: "home"
        },

        home: {
          type: String,
          reflectToAttribute: true,
          observer: '_homeChanged',
          value: 'default',
        },

        intendedCat: {
          type: String,
          value: 'default'
        },

        catData: {
          type: Object,
          value: {
            category: 'default'
          }
        },

        category: {
          type: String,
          reflectToAttribute: true,
          observer: '_catChanged',
          value: 'default',
        },

        page: {
          type: String,
          reflectToAttribute: true,
        },

        patient: {
          type: String,
          reflectToAttribute: true,
          observer: '_patientChanged'
        },

        param: {
          type: String,
          reflectToAttribute: true
        },

        login: {
          type: Object,
        },

        fromLogin: {
          type: Boolean,
          value: false
        },

        payments: {
          type: Array,
          value: []
        },

        noPayment: {
          type: Boolean,
          value: false
        },

        appModules:{
          type:Object,
          value:{
            carePlan:{
              active:true,
              description:"The Main Module that does all the main stuff. Available now."
            },
            medication:{
              active:false,
              description:"Medication module takes care of medication stuff."
            },
            training:{
              active:false,
              description:"Trainging module takes care of training stuff."
            },
            healthSafety:{
              active:false,
              description:"Health and safety module that takes care of health and safety stuff."
            },
            policiesProcedures:{
              active:false,
              description:"Policies and Procedures module that takes care of health and safety stuff."
            },
            analytics:{
              active:false,
              description:"Analytics module that takes care of health and safety stuff."
            },
            communication:{
              active:false,
              description:"Communication module that takes care of communication stuff"
            },
            staffManager:{
              active:false,
              description:"Staff manager module that takes care of staff management stuff."
            },
            mealPlanning:{
              active:false,
              description:"Meal planning module that takes care of meal planning stuff."
            }
          }
        }
      },
      //routing config
      observers: [
        '_homeRouteChanged(homeData.home)',
        '_catRouteChanged(catData.category)',
        '_pageRouteChanged(pageData.page)',
        '_patientRouteChanged(patientData.patient)',
        '_paramRouteChanged(paramData.param)'
      ],

      behaviors: [
        //Polymer.shellResizeBehavior,
        Polymer.pageChangeMiddleware,
        Polymer.accountCreateBehavior,
        Polymer.pushNotificationBehavior,
        Polymer.paymentCheckBehavior,
        Polymer.signInBehavior,
        Polymer.notificationBehavior
      ],

      ready:function(){
        this.addEventListener('openToast', this.openToast);
        this.addEventListener('closeToast', this.closeToast);
        this.addEventListener('app-drawer-transitioned', this.resizeDrawerImage);
        this.addEventListener("resize", this.resizeElements);
        this.addEventListener("openBottomNav", this.openBottomNav);
        this.addEventListener("closeBottomNav", this.closeBottomNav);
        //this.$.storage._downloadFile(this.$.storage.path);
      },

      attached:function(){
        this.resizeElements();
      },

      _atHome: function(page) {
        return page === 'def-home';
      },

      _computeBackButtonClass: function(page) {
        return page === 'def-home' ? 'back-button-disabled' : '';
      },

      openOverflow: function(e) {
        var beforeWidth = Math.sqrt(Math.pow(20, 2) + Math.pow(20, 2));
        this.$.overflowDialog.positionTarget = e.currentTarget;
        this.$.overflowDialog.verticalAlign = "top";
        this.$.overflowDialog.horizontalAlign = "right";
        this.$.overflowDialog.noOverlap = true;
        this.$.overflowDialog.classList.add("dialogPointer");
        this.$.overflowDialog.horizontalOffset = (e.currentTarget.offsetWidth / 2) - beforeWidth;
        this.$.overflowDialog.style = "";

        this.$.searchDialog.close();
        this.$.appsDialog.close();
        this.$.logoutDialog.close();
        this.$.notifyDialog.close();
        this.$.overflowDialog.toggle();
      },

      _computeSubSelected: function(name, page) {
        switch(name) {
          case 'profile':
            return page === 'su-profile'
            || page === 'su-pre'
            || page === 'su-uploads'
            ? 'sub-header-menu-selected'
            : 'sub-header-menu';
            break;
          case 'care':
            return page === 'su-care'
            || page === 'su-care-review'
            ? 'sub-header-menu-selected'
            : 'sub-header-menu';
            break;
          case 'reports':
            return page === 'su-reports'
            || page === 'su-monthly-reports'
            || page === 'su-view-reports'
            ? 'sub-header-menu-selected'
            : 'sub-header-menu';
          default:
            return 'su-view-reports';
            break;
        };
      },

      closeSubMenuDialog: function() {
        this.$.subMenuDialog.close();
      },

      openProfileSub: function(e) {
        var el = e.currentTarget;
        this.subMenuItems = [];
        switch(el.id) {
          case 'profile':
            this.set('subMenuItems', [
              {
                name: 'su-profile',
                display: 'Personal Profile'
              },

              {
                name: 'su-pre',
                display: 'Pre-Admission Assessment'
              },

              {
                name: 'su-uploads',
                display: 'File Uploads'
              }
            ]);
            break;
          case 'care':
            this.set('subMenuItems', [
              {
                name: 'su-care',
                display: 'Care Plan'
              },

              {
                name: 'su-care-review',
                display: 'Care Plan Review'
              }
            ]);
            break;
          case 'reports':
            this.set('subMenuItems', [
              {
                name: 'su-reports',
                display: 'Daily Reports'
              },

              {
                name: 'su-monthly-reports',
                display: 'Monthly Reports'
              },

              {
                name: 'su-view-reports',
                display: 'View Reports'
              }
            ]);
            break;
        }
        this.$.subMenuDialog.positionTarget = el;
        this.$.subMenuDialog.verticalAlign = 'top';
        this.$.subMenuDialog.sizingTarget = this;
        this.$.subMenuDialog.noOverlap = true;
        this.$.subMenuDialog.horizontalAlign = 'left';
        this.$.subMenuDialog.refit()
        this.$.subMenuDialog.open();
      },

      openSearch: function() {
        this.$.searchDialog.positionTarget = this.$.bottomNav;
        this.$.searchDialog.verticalAlign = 'top';
        this.$.searchDialog.noOverlap = true;
        this.$.searchDialog.toggle();
      },

      _onlineChanged: function(online) {
        if(online) {
          this.customStyle["--app-dynamic-primary-color"] = '#3d4ba8';
        } else {
          this.customStyle["--app-dynamic-primary-color"] = 'grey';
        };
        this.updateStyles();
      },

      _homeRouteChanged:function(home){
        this.home=home || 'default';
      },

      _catRouteChanged:function(category){
        this.category = category || 'default';
      },

      _pageRouteChanged:function(page) {
          this.currentPage = this.selected;
          this.page = page || 'def-home';
      },

      _patientRouteChanged: function(patient) {
        this.patient = patient || '';
      },

      _paramRouteChanged:function(param){
        this.param = param || '';
      },

      _homeChanged:function(home){
        if(home != 'default'){
          this.home = this.homeData.home;
          this.$.settingsDB.path = "/homes/" + this.home + "/settings";
        };
        //lockout of dev server for beta tester
        if(home === "-KRSjsbJCBdJM8et8BUe") {
          this.$.movedDialog.open();
        };
      },

      _catChanged:function(cat){
        this.category=this.catData.category;
        //make an exception for the default category 'default' if not default track changes to cat
        if(cat!='default'){

        }
      },

      _patientChanged: function() {
        this.patient = this.patientData.patient || '';
        this.searchVal = "";
      },

      toggleDrawer:function(){
        this.$.adminDrawer.opened=!this.$.adminDrawer.opened;
      },

      //other stuff
      handleError:function(error){

      },

      _patientSelected:function(category, patient){
        if((this.category==="care-plan" || "test") && this.patient){
          return true;
        } else {
          return false;
        };
      },

      goBack:function(){
        var isEdit = this.page.split('-').pop() === 'edit';
        var homeUrl = '/' + this.home + '/default/' + 'def-home';
        if(this.page === 'def-error') {
          window.history.go(-2);
        } else if(isEdit){
          window.history.back();
        } else {
          window.history.pushState({}, null, homeUrl);
          window.dispatchEvent(new CustomEvent('location-changed'));
        };

        window.history.pushState({}, null, window.location.href);
        window.dispatchEvent(new CustomEvent('location-changed'));
      },

      _computeDrawerHidden:function(page){
        if(page.slice(0,3)==="def" || page.slice(0,2)==="ad"){
          return true;
        } else {
          return false;
        }
      },

      openToast:function(e){
        this.$.mainToast.text=e.detail.toastText;
        if(e.detail.terms) {
          this.termsHidden = false;
        } else {
          this.termsHidden = true;
        }
        this.$.mainToast.open();
      },

      closeToast:function(){
        this.$.mainToast.close();
      },

      searchFilter:function(val){
        if(val.length<3){
          this.$.searchDropdown.hide();
          return null;
        } else {
          var val = val.toLowerCase();
          this.$.searchDropdown.show();
          return function(search){
            if(search.fName && search.lName) {
              var fName = search.fName.toLowerCase();
              var lName = search.lName.toLowerCase();
              var fullName = fName + ' ' + lName;
              var fNameMatches = fName.indexOf(val) != -1;
              var lNameMatches = lName.indexOf(val) != -1;
              var fullNameMatches = fullName.indexOf(val) != -1;
              var notArchived = search.currentStatus != 'archived';
              return (fNameMatches || lNameMatches || fullNameMatches) && notArchived;
            };
          };
        };
      },

      clearSearch:function(){
        this.searchVal="";
      },

      hideSearch:function(){
        this.$.searchDropdown.hide();
      },

      showNotifications:function(){
        this.$.notificationDropdown.toggle();
      },

      openApps:function(e){
        // hypotenuse of 45 degree rotated square that is before the dialog... meaning the width in relative terms
        var beforeWidth = Math.sqrt(Math.pow(20, 2) + Math.pow(20, 2));
        var containedIcon = Polymer.dom(e.currentTarget).children[0];
        this.$.appsDialog.positionTarget = e.currentTarget;
        this.$.appsDialog.verticalAlign = "top";
        this.$.appsDialog.horizontalAlign = "right";
        this.$.appsDialog.noOverlap = true;
        this.$.appsDialog.classList.add("dialogPointer");
        this.$.appsDialog.horizontalOffset = (e.currentTarget.offsetWidth / 2) - beforeWidth;
        this.$.appsDialog.style = "";
        this.$.overflowDialog.close();
        this.$.logoutDialog.close();
        this.$.notifyDialog.close();
        this.$.searchDialog.close();
        this.$.appsDialog.toggle();
      },

      openApp:function(e){
        var appModule = e.currentTarget.getAttribute("data-name");
        if(this.appModules[appModule].active){
          //implement module changes later on when we have another module to show...
          console.log("go to the other module");
        } else {
          this.appModuleName = this.convertCamel(appModule);
          this.appModuleText = this.appModules[appModule].description;
          this.$.appPromoDialog.open();
        };
      },

      convertCamel:function(camelCase){
        if (camelCase == null || camelCase == "") {
          return camelCase;
        }

        camelCase = camelCase.trim();
        var newText = "";
        for (var i = 0; i < camelCase.length; i++) {
          if (/[A-Z]/.test(camelCase[i])
              && i != 0
              && /[a-z]/.test(camelCase[i-1])) {
            newText += " ";
          }
          if (i == 0 && /[a-z]/.test(camelCase[i]))
          {
            newText += camelCase[i].toUpperCase();
          } else {
            newText += camelCase[i];
          }
        }
        return newText;
      },

      openNotifications:function(e){
        // hypotenuse of 45 degree rotated square that is before the dialog... meaning the width in relative terms
        var beforeWidth = Math.sqrt(Math.pow(20, 2) + Math.pow(20, 2));
        var containedIcon = Polymer.dom(e.currentTarget).children[0];

        this.$.notifyDialog.positionTarget = e.currentTarget;
        this.$.notifyDialog.verticalAlign = "top";
        this.$.notifyDialog.horizontalAlign = "right";
        this.$.notifyDialog.noOverlap = true;
        this.$.notifyDialog.classList.add("dialogPointer");
        this.$.notifyDialog.horizontalOffset = (e.currentTarget.offsetWidth / 2) - beforeWidth;

        this.$.notifyDialogScroll.dialogElement = this.$.notifyDialog;
        if(this.notifiesData.length<1){
          return;
        };
        this.$.searchDialog.close();
        this.$.overflowDialog.close();
        this.$.appsDialog.close();
        this.$.logoutDialog.close();
        this.$.notifyDialog.toggle();
      },

      checkNotification:function(){
        this.$.notifyDialog.close();
      },

      _initializeRecentUsers:function(){
        this.$.recentUsers.value=[];
      },

      _initializeDeviceNames: function() {
        console.log("initializing device names");
        this.set("deviceNames", {});
      },

      _initializeAppVersion: function() {
        console.log('initializing app verion');
        this.set('appVersion', 'new');
      },

      _computeUserPhoto:function(photo){
        return photo || "/images/defaultAvatar.png"
      },

      _computeDisplayName:function(name){
        if(name === "undefined undefined"){
          return "click here to set display name.";
        } else {
          return name;
        };
      }

    });

  </script>

</dom-module>
