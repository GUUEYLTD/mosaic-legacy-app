<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/polymerfire/firebase-document.html" />
<link rel="import" href="../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html" />
<link rel="import" href="../../../bower_components/iron-icons/communication-icons.html" />
<link rel="import" href="../../../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../../../bower_components/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="../../../bower_components/paper-time-picker/paper-time-picker-dialog-style.html" />
<link rel="import" href="../../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html" />

<link rel="import" href="../../elements/su-header/su-header.html" />
<link rel="import" href="../../elements/guuey-date-input/guuey-date-input.html" />
<link rel="import" href="../../elements/media-queries/media-queries.html" />

<link rel="import" href="../../behaviors/animations/care-plan-animation.html" />
<link rel="import" href="../../behaviors/su-print-behavior.html" />
<link rel="import" href="../../behaviors/su-resize-behavior.html" />

<link rel="import" href="../../styles/common-styles.html" />

<dom-module id="su-profile">

  <template>

    <media-queries
      dimensions="{{dimensions}}">
    </media-queries>

    <app-indexeddb-mirror
      id="profileMirror"
      session="[[userUid]]"
      key="profileDB|[[patient]]"
      data="{{profileDataLive}}"
      persisted-data="{{profileData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="profileDB"
      path="/homes/[[home]]/patients/[[patient]]/personalProfile"
      data="{{profileDataLive}}"
      app-name="main">
    </firebase-document>

    <app-indexeddb-mirror
      id="contactsQueryMirror"
      session="[[userUid]]"
      key="contactsQuery|[[patient]]"
      data="{{contactsDataLive}}"
      persisted-data="{{contactsData}}"
      worker-url="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-worker.js">
    </app-indexeddb-mirror>

    <firebase-document
      id="contactsQuery"
      path="/homes/[[home]]/patients/[[patient]]/contacts"
      data="{{contactsDataLive}}"
      app-name="main">
    </firebase-document>

    <style include="common-styles">
      :host{
        --app-grid-columns:2;
        --app-grid-expandible-item-columns:2;
        --app-grid-item-height:100px;
      }
      iron-icon{
        width:10%;
        margin:50px 0px 0px 0px;
        position:absolute;
        top:0px;
        bottom:0px;
      }
      .inputContainer{
          width:90%;
          margin:0px;
          float:right;
      }
      paper-input, guuey-date-input, vaadin-combo-box{
        padding:20px;
      }
      .sectionContainer{
        position:relative;
      }
    </style>

    <paper-card id="mainCard" class="pageCard" elevation="3">
      <su-header
        id="suHeader"
        page="Personal Profile"
        patient="[[patient]]"
        home="[[home]]"
        setimage
        su-index-data={{suIndexData}}>
      </su-header>

      <div class="innerCont padded">
        <div class="sectionContainer">
          <iron-icon icon="social:person-outline"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="First Name"
              value="{{suIndexData.fName}}"
              tabindex="1"
              required
              auto-validate
              pattern="[a-zA-Z]*"
              error-message="Please enter a valid first name.">
            </paper-input>

            <paper-input
              label="Last Name"
              value="{{suIndexData.lName}}"
              tabindex="2"
              required
              auto-validate
              pattern="[a-zA-Z]*"
              error-message="Please enter a valid last name.">
            </paper-input>

            <guuey-date-input
              value="{{profileData.dob}}"
              label="Date of Birth"
              tabindex="3"
              required
              auto-validate
              error-message="Please enter a date by clicking on tapping/clicking on this field.">
            </guuey-date-input>

            <paper-input
              label="Preferred Mode of Adress"
              value="{{profileData.preferredName}}"
              tabindex="4"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Mode of address cannot contain numbers or special characters.">
            </paper-input>

            <guuey-date-input
              value="{{profileData.dateAssessed}}"
              label="Date Assessed"
              tabindex="5"
              required
              auto-validate
              error-message="Please enter a date by clicking on tapping/clicking on this field.">
            </guuey-date-input>

            <!--more validation???? address? or what???-->
            <paper-input
              label="Where Assessed"
              value="{{profileData.whereAssessed}}"
              tabindex="6"
              required
              auto-validate
              error-message="Please enter the location of service user assessment.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="icons:assignment"></iron-icon>

          <div class="inputContainer app-grid">
            <vaadin-combo-box
              allow-custom-value
              label="Partership Status"
              items="[[parterShipStatuses]]"
              value="{{profileData.partnership}}"
              required
              auto-validate
              pattern="[a-zA-Z\s]*"
              error-message="Please enter or select a partnership status without any special characters."
              tabindex="7">
            </vaadin-combo-box>

            <vaadin-combo-box
              allow-custom-value
              label="Religion"
              items="[[religions]]"
              value="{{profileData.religion}}"
              required
              auto-validate
              pattern="[a-zA-Z\s]*"
              error-message="Please enter a religion without special characters."
              tabindex="8">
            </vaadin-combo-box>

            <vaadin-combo-box
              allow-custom-value
              label="Ethnicity"
              items="[[ethnicities]]"
              value="{{profileData.ethnicity}}"
              required
              auto-valdate
              pattern="[a-zA-Z\s]*"
              error-message="Please enter an ethnicity without special characters."
              tabindex="9">
            </vaadin-combo-box>

            <vaadin-combo-box
              allow-custom-value
              label="Nationality"
              items="[[nationalities]]"
              value="{{profileData.nationality}}"
              required
              auto-validate
              pattern="[a-zA-Z\s]*"
              error-message="Please enter a nationality without special characters."
              tabindex="10">
            </vaadin-combo-box>
          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:phone"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Next of Kin"
              value="{{contactsData.nextOfKinName}}"
              tabindex="11"
              required
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <vaadin-combo-box
              allow-custom-value
              label="Relationship"
              items="[[relationships]]"
              value="{{contactsData.nextOfKinRelationship}}"
              tabindex="12"
              required
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter the relationship to the service user.">
            </vaadin-combo-box>

            <paper-input
              label="Address"
              value="{{contactsData.nextOfKinAddress}}"
              tabindex="13"
              required
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.nextOfKinPhone}}"
              tabindex="14"
              required
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:phone"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Second Contact Name"
              value="{{contactsData.secondContactName}}"
              tabindex="15"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <vaadin-combo-box
              allow-custom-value
              label="Relationship"
              items="[[relationships]]"
              value="{{contactsData.secondContactRelationship}}"
              tabindex="16"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter the relationship to the service user.">
            </vaadin-combo-box>

            <paper-input
              label="Address"
              value="{{contactsData.secondContactAddress}}"
              tabindex="17"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.secondContactPhone}}"
              tabindex="18"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:contact-mail"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Consultant Psychiatrist"
              value="{{contactsData.consultantPsychiatristName}}"
              tabindex="19"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <paper-input
              label="Address"
              value="{{contactsData.consultantPsychiatristAddress}}"
              tabindex="20"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.consultantPsychiatristPhone}}"
              tabindex="21"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:contact-mail"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="General Practitioner"
              value="{{contactsData.generalPractitionerName}}"
              tabindex="22"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <paper-input
              label="Address"
              value="{{contactsData.generalPractitionerAddress}}"
              tabindex="23"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.generalPractitionerPhone}}"
              tabindex="24"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:contact-mail"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Social Worker/Referrer"
              value="{{contactsData.socialWorkerReferrerName}}"
              tabindex="25"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <paper-input
              label="Address"
              value="{{contactsData.socialWorkerReferrerAddress}}"
              tabindex="26"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.socialWorkerReferrerPhone}}"
              tabindex="27"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

        <div class="sectionContainer">

          <iron-icon icon="communication:contact-mail"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Community Psychiatric Nurse (CPN)"
              value="{{contactsData.cpnName}}"
              tabindex="28"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <paper-input
              label="Address"
              value="{{contactsData.cpnAddress}}"
              tabindex="29"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.cpnPhone}}"
              tabindex="30"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>


        <div class="sectionContainer">

          <iron-icon icon="communication:contact-mail"></iron-icon>

          <div class="inputContainer app-grid">

            <paper-input
              label="Minister of Religion"
              value="{{contactsData.ministerOfReligionName}}"
              tabindex="31"
              auto-validate
              pattern="[a-zA-Z\.\s]*"
              error-message="Please enter a valid name.">
            </paper-input>

            <paper-input
              label="Address"
              value="{{contactsData.ministerOfReligionAddress}}"
              tabindex="32"
              auto-validate
              pattern="[A-Za-z0-9'\.\-\s,]*"
              error-message="Please enter a valid address">
            </paper-input>

            <paper-input
              label="Telephone"
              value="{{contactsData.ministerOfReligionPhone}}"
              tabindex="33"
              auto-validate
              pattern="\+?\(?\d{2,4}\)?[\d\s-]{3,}"
              error-message="Please enter a valid phone Number.">
            </paper-input>

          </div>
        </div>

        <div class="divider"></div>

      </div>
    </paper-card>

  </template>
  <script>

    Polymer({

      is: 'su-profile',

      ready: function() {
        this.addEventListener("print", this.print);
        this.fire("pageLoaded",{page: this.page});
      },

      properties: {

        page: {
          type: String,
        },

        patient: {
          type: String,
        },

        home: {
          type: String,
        },

        dimensions: {
          type: Object,
          value: {}
        },

        guueyDOA: {
          type: String,
          value: "loading"
        },

        guueyDOB: {
          type: String,
          value: "loading"
        },

        //list of dropdown values for vaadin boxes... put in db???
        religions: {
          type: Array,
          value: [
            'Christian',
            'Islam',
            'Atheist',
            'Unaffiliated',
            'Hinduist',
            'Buddhist',
            'Jewish'
          ]
        },

        parterShipStatuses: {
          type: Array,
          value: [
            'Single',
            'Married',
            'Divorced',
            'Complicated'
          ]
        },

        ethnicities: {
          type: Array,
          value: [
            'Albanian',
            'Arab',
            'Armenian',
            'Assyrian',
            'Azerbaijani',
            'Balochi',
            'Bamar',
            'Basque',
            'Bengali',
            'Berber',
            'Bihari',
            'Bosniak',
            'Brahui',
            'Bulgarian',
            'Catalan',
            'Chuvash',
            'Circassian',
            'Congolese',
            'Croat',
            'Czech',
            'Dane',
            'Dutch',
            'English',
            'Estonian',
            'Faroese',
            'Finn',
            'French',
            'Gagauz',
            'Galician',
            'German',
            'Greek',
            'Georgian',
            'Gujarati',
            'Han Chinese',
            'Hindustani',
            'Hui',
            'Hungarian',
            'Icelander',
            'Irish',
            'Italian',
            'Japanese',
            'Javanese',
            'Jew',
            'Lebanese',
            'Macedonian',
            'Malayali',
            'Kannada',
            'Kazakh',
            'Korean',
            'Kurd',
            'Kyrgyz',
            'Malay',
            'Marathi',
            'Norwegian',
            'Laz',
            'Manchu',
            'Moldovan',
            'Mongol',
            'Nepali',
            'Pashtun',
            'Oromo',
            'Persian',
            'Pole',
            'Portuguese',
            'Punjabi',
            'Romanian',
            'Romani',
            'Russian',
            'Scottish',
            'Serb',
            'Sindhi',
            'Sinhalese',
            'Slovak',
            'Slovene',
            'Spaniard',
            'Sundanese',
            'Swede',
            'Tamil',
            'Telugu',
            'Thai',
            'Tibetan',
            'Tuareg',
            'Turk',
            'Turkmen',
            'Ukrainian',
            'Uyghur',
            'Vietnamese',
            'Volga Tatar',
            'Welsh',
            'Zhuang',
          ]
        },

        nationalities: {
          type: Array,
          value: [
            'Afghan',
            'Albanian',
            'Algerian',
            'American',
            'Andorran',
            'Angolan',
            'Antiguans',
            'Argentinean',
            'Armenian',
            'Australian',
            'Austrian',
            'Azerbaijani',
            'Bahamian',
            'Bahraini',
            'Bangladeshi',
            'Barbadian',
            'Barbudans',
            'Batswana',
            'Belarusian',
            'Belgian',
            'Belizean',
            'Beninese',
            'Bhutanese',
            'Bolivian',
            'Bosnian',
            'Brazilian',
            'British',
            'Bruneian',
            'Bulgarian',
            'Burkinabe',
            'Burmese',
            'Burundian',
            'Cambodian',
            'Cameroonian',
            'Canadian',
            'Cape Verdean',
            'Central African',
            'Chadian',
            'Chilean',
            'Chinese',
            'Colombian',
            'Comoran',
            'Congolese',
            'Congolese',
            'Costa Rican',
            'Croatian',
            'Cuban',
            'Cypriot',
            'Czech',
            'Danish',
            'Djibouti',
            'Dominican',
            'Dominican',
            'Dutch',
            'Dutchman',
            'Dutchwoman',
            'East Timorese',
            'Ecuadorean',
            'Egyptian',
            'Emirian',
            'Equatorial Guinean',
            'Eritrean',
            'Estonian',
            'Ethiopian',
            'Fijian',
            'Filipino',
            'Finnish',
            'French',
            'Gabonese',
            'Gambian',
            'Georgian',
            'German',
            'Ghanaian',
            'Greek',
            'Grenadian',
            'Guatemalan',
            'Guinea-Bissauan',
            'Guinean',
            'Guyanese',
            'Haitian',
            'Herzegovinian',
            'Honduran',
            'Hungarian',
            'I-Kiribati',
            'Icelander',
            'Indian',
            'Indonesian',
            'Iranian',
            'Iraqi',
            'Irish',
            'Israeli',
            'Italian',
            'Ivorian',
            'Jamaican',
            'Japanese',
            'Jordanian',
            'Kazakhstani',
            'Kenyan',
            'Kittian and Nevisian',
            'Kuwaiti',
            'Kyrgyz',
            'Laotian',
            'Latvian',
            'Lebanese',
            'Liberian',
            'Libyan',
            'Liechtensteiner',
            'Lithuanian',
            'Luxembourger',
            'Macedonian',
            'Malagasy',
            'Malawian',
            'Malaysian',
            'Maldivan',
            'Malian',
            'Maltese',
            'Marshallese',
            'Mauritanian',
            'Mauritian',
            'Mexican',
            'Micronesian',
            'Moldovan',
            'Monacan',
            'Mongolian',
            'Moroccan',
            'Mosotho',
            'Motswana',
            'Mozambican',
            'Namibian',
            'Nauruan',
            'Nepalese',
            'Netherlander',
            'New Zealander',
            'Ni-Vanuatu',
            'Nicaraguan',
            'Nigerian',
            'Nigerien',
            'North Korean',
            'Northern Irish',
            'Norwegian',
            'Omani',
            'Pakistani',
            'Palauan',
            'Panamanian',
            'Papua New Guinean',
            'Paraguayan',
            'Peruvian',
            'Polish',
            'Portuguese',
            'Qatari',
            'Romanian',
            'Russian',
            'Rwandan',
            'Saint Lucian',
            'Salvadoran',
            'Samoan',
            'San Marinese',
            'Sao Tomean',
            'Saudi',
            'Scottish',
            'Senegalese',
            'Serbian',
            'Seychellois',
            'Sierra Leonean',
            'Singaporean',
            'Slovakian',
            'Slovenian',
            'Solomon Islander',
            'Somali',
            'South African',
            'South Korean',
            'Spanish',
            'Sri Lankan',
            'Sudanese',
            'Surinamer',
            'Swazi',
            'Swedish',
            'Swiss',
            'Syrian',
            'Taiwanese',
            'Tajik',
            'Tanzanian',
            'Thai',
            'Togolese',
            'Tongan',
            'Trinidadian or Tobagonian',
            'Tunisian',
            'Turkish',
            'Tuvaluan',
            'Ugandan',
            'Ukrainian',
            'Uruguayan',
            'Uzbekistani',
            'Venezuelan',
            'Vietnamese',
            'Welsh',
            'Welsh',
            'Yemenite',
            'Zambian',
            'Zimbabwean',
          ]
        },

        relationships: {
          type: Array,
          value: [
            'Father',
            'Mother',
            'Brother',
            'Sister',
            'Aunt',
            'Uncle',
            'Grandfather',
            'Grandmother',
            'Grandson',
            'Granddaughter',
            'Nephew',
            'Neice',
            'Cousin',
            'Husband',
            'Wife',
          ]
        }
      },

      observers: [
        "_requirementsMet(profileData)"
      ],

      behaviors: [
        Polymer.carePlanAnimation,
        Polymer.suPrintBehavior,
        Polymer.suResizeBehavior
      ],

      _requirementsMet: function(data) {
        if(Object.keys(data).length === 0 && data.constructor === Object && this.guueyDOB != "loading" && this.guueyDOA != "loading") {
        } else {
          if(!data.fName) {
            this.fire("openToast", {toastText: "First name is required before saving the new service user."});
            return;
          } else if(!data.lName) {
            this.fire("openToast", {toastText: "Last name is required before saving the new service user."});
            return;
          } else if(!data.dob) {
            this.fire("openToast", {toastText: "Date of birth is required before saving the new service user."});
            return;
          } else if(!data.dateAssessed) {
            this.fire("openToast", {toastText: "Date of assessment is required before saving the new service user."});
            return;
          } else if(!data.partnership) {
            this.fire("openToast", {toastText: "Partnership status is required before saving the new service user."});
            return;
          } else if(!data.whereAssessed) {
            this.fire("openToast", {toastText: "Where assessed is required before saving the new service user."});
          } else if(!data.religion) {
            this.fire("openToast", {toastText: "Religion is required before saving the new service user."});
          } else if(!data.ethnicity) {
            this.fire("openToast", {toastText: "Ethnicity is required before saving the new service user."});
          } else if(!data.nationality) {
            this.fire("openToast", {toastText: "Nationality is required before saving the new service user."});
          } else {
            return true;
          };
        };
      }

    });

  </script>

</dom-module>
