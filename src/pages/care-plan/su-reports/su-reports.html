<link rel="import" href="dependencies.html" />

<dom-module id="su-reports">

  <template>

    <media-queries
      dimensions="{{dimensions}}">
    </media-queries>

    <firebase-document
      id="dailyRepDB"
      app-name="main"
      path="homes/[[home]]/patients/[[patient]]/dailyReports/[[currentDate]]/[[selectedChunk]]"
      data="{{dailyRepData}}">
    </firebase-document>

    <style include="common-styles">

      .sliderRow{
        margin-top:20px;
        display:flex;
        flex-direction:row;
      }
      .sliderRow paper-slider{
        flex-grow:50;
      };
      .sliderRow iron-icon{
        flex-grow:1;
      }
      #iconGood{
        color:#43A047;
      }
      #iconBad{
        color:#E53935;
      }
      .sliderOutput{
        text-align:center;
        font-size:120%;
        margin:10px;
        padding:10px;
      }

    </style>

    <paper-card class="pageCard">

      <su-header
        id="suHeader"
        page="Daily Reports"
        patient="[[patient]]"
        home="[[home]]"
        su-index-data="{{suIndexData}}"
        setimage>
      </su-header>

      <div class="pageInnerCont padded">
        <h2>Daily Report for [[suIndexData.fName]] [[suIndexData.lName]]: [[selectedChunk]]</h2>
        <paper-dropdown-menu
          id="chunkSelector"
          label="Reports for different times of day">
          <paper-listbox class="dropdown-content" attr-for-selected="label" selected="{{selectedChunk}}">
            <template is="dom-repeat" items="[[chunkList]]" as="chunk">

              <paper-item label="[[chunk]]">[[chunk]]</paper-item>

            </template>
          </paper-listbox>
        </paper-dropdown-menu>

        <div class="sliderRow">
          <iron-icon id="iconBad" icon="icons:thumb-down"></iron-icon>
          <paper-slider pin value="{{dailyRepData.mood}}"></paper-slider>
          <iron-icon id="iconGood" icon="icons:thumb-up"></iron-icon>
        </div>
        <p hidden="[[!dailyRepData.mood]]" class="sliderOutput">
          [[suIndexData.fName]]'s overall mood was <b>[[dailyRepData.mood]]</b> out of 100 for this shift.
        </p>
        <p hidden="[[dailyRepData.mood]]" class="sliderOutput">
          Please select a value out of 100 for [[suIndexData.fName]]'s overall mood.
        </p>

        <paper-textarea label="Comments on Mood" value="{{dailyRepData.moodComments}}"></paper-textarea>

        <div class="sliderRow">
          <iron-icon id="iconBad" icon="icons:thumb-down"></iron-icon>
          <paper-slider pin value="{{dailyRepData.health}}"></paper-slider>
          <iron-icon id="iconGood" icon="icons:thumb-up"></iron-icon>
        </div>
        <p hidden="[[!dailyRepData.health]]" class="sliderOutput">
          [[suIndexData.fName]]'s overall health was <b>[[dailyRepData.health]]</b> out of 100 for this shift.
        </p>
        <p hidden="[[dailyRepData.health]]" class="sliderOutput">
          Please select a value out of 100 for [[suIndexData.fName]]'s overall health.
        </p>

        <paper-textarea label="Comments on Health" value="{{dailyRepData.healthComments}}"></paper-textarea>


        <div class="divider"></div>

        <paper-textarea label="activities" value="{{dailyRepData.activities}}"></paper-textarea>
        <paper-textarea label="locations" value="{{dailyRepData.locations}}"></paper-textarea>
        <paper-textarea label="incidents" value="{{dailyRepData.incidents}}"></paper-textarea>
        <paper-textarea label="summary of shift" value="{{dailyRepData.summaryOfChunk}}"></paper-textarea>


      </div>

    </paper-card>

  </template>

  <script>

    Polymer({
      is:"su-reports",
      ready:function(){
        this.fire("pageLoaded", {page:this.page});
        this.updateTime();
        this.set("selectedChunk",this.currentChunk);
        setInterval(function(){
          this.updateTime()
        }.bind(this),1000*60*60);
      },
      properties:{
        currentChunk:{
          type:String,
          value:""
        },
        currentDate:{
          type:String,
          value:""
        },
        selectedChunk:{
          type:String,
          value:""
        },
        chunkList:{
          type:Array,
          value:[
            "Morning",
            "Afternoon",
            "Night"
          ]
        },
        dailyRepData:{
          type:Object,
          value:{
            mood:50,
            health:50
          }
        }
      },
      observers:[

      ],
      behaviors:[
        Polymer.carePlanAnimation,
        Polymer.suPrintBehavior,
        Polymer.suResizeBehavior
      ],
      updateTime:function(){
        //date for both data points
        var date = new Date();
        //days months years for date marker
        var days=date.getDate();
        var months=date.getMonth();
        var years=date.getFullYear();
        var currentDate = new Date(years, months, days);
        currentDate=currentDate.getTime()
        //function to set the hours to get time chunks and calculate
        var hours=date.getHours();
        var altChunks=[
          "Morning",
          "Afternoon",
          "Night"
        ];
        var timeChunk;
        if(hours>=4 && hours<12){
          timeChunk="Morning";
        };
        if(hours>=12 && hours<20){
          timeChunk="Afternoon";
        };
        if(hours>=20 || hours<4){
          timeChunk="Night";
        };
        //set the two calculated time values... used in db ops as well
        this.set("currentChunk",timeChunk);
        this.set("currentDate", currentDate);
      }

    });

  </script>

</dom-module>
