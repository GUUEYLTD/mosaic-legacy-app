<link rel="import" href="../../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../../bower_components/paper-checkbox/paper-checkbox.html" />
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../../bower_components/iron-icons/editor-icons.html" />
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html" />

<!--temp animations till hero animations work-->
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-up-animation.html" />
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-down-animation.html" />

<link rel="import" href="../../../elements/guuey-date-input/guuey-date-input.html" />
<link rel="import" href="../../../elements/guuey-notify/guuey-notify.html" />
<link rel="import" href="../../../elements/media-queries/media-queries.html">

<link rel="import" href="../../../styles/common-styles.html" />

<link rel="import" href="../../../behaviors/edit-view-resize-behavior.html" />
<link rel="import" href="../../../behaviors/multi-edit-animation-behavior.html" />

<dom-module id="su-goals-edit-view">

  <template>

  <style include="common-styles">
    .detailBar{
      background-color:#E0E0E0;
      width:100%;
      background-repeat:no-repeat;
      background-size:auto 100%;
      background-position:bottom left;
      margin: 0px 0 20px 0;
    }
    .inputContainer{
      padding:20px;
    }
    .detailBarInput{
      width:50%;
      padding:0% 25% 20px 25%;
      --paper-input-container-color:#4DB6AC;
      --paper-input-container-input-color:#4DB6AC;
      padding:var(--detail-bar-padding);
    }
    .descriptionContainer{
      margin-top:20px;
    }
    .descriptionContainer paper-input{
      width:50%;
      padding:0% 25% 20px 25%;
      --paper-input-container-color:#FFFFFF;
      --paper-input-container-input-color:#FFFFFF;
      padding:var(--description-container-padding);
    }
    .detailDescription{
      background-color:#4DB6AC;
      width:100%;
      background-repeat:no-repeat;
      background-size:auto 100%;
      background-position:bottom left;
      margin: 0px 0 20px 0;
    }
  </style>

    <paper-dialog id="stepModal" class="guuey-modal guuey-add-modal">
      <h2>Add/update Step</h2>
      <paper-input
        label="describe the step"
        value="{{stepData.description}}"
        required
        auto-validate
        pattern="[a-zA-Z\s\.!\d]*"
        error-message="Please describe the step.">
      </paper-input>
      <paper-input
        label="step number"
        value="{{stepData.order}}"
        required
        auto-validate
        pattern="\d{1,1}"
        error-message="Please enter a step from 1 to 9">
      </paper-input>
      <div class="modal-button-container">
        <paper-button on-tap="cancelStep">cancel</paper-button>
        <paper-button on-tap="saveStep">save</paper-button>
      </div>
    </paper-dialog>

    <paper-card class="editViewCard">

      <div
        class="detailBar"
        style="background-image:url(../../../../{{_computeGoalImage(goalData.category)}})">
          <vaadin-combo-box
            allow-custom-value
            label="Category"
            items="[[goalTypes]]"
            value="{{goalData.category}}"
            class="detailBarInput">
          </vaadin-combo-box>
      </div>

      <div class="inputContainer">

        <guuey-date-input
          value="{{goalData.startDate}}"
          label="Start Date">
        </guuey-date-input>

        <guuey-notify
          home="[[home]]"
          notify-route="homes/[[home]]/patients/[[patient]]/personalGoals/[[goalUID]]/finishDate"
          condition-type="guuey-date"
          notify-condition="true"
          notify-message="[[suBasicInfo.fName]] [[suBasicInfo.lName]]'s [[goalData.category]] goal completion date is soon."
          notify-url="/[[home]]/care-plan/su-goals/[[patient]]">
        </guuey-notify>

        <guuey-date-input
          value="{{goalData.finishDate}}"
          label="Estimated Finish Date">
        </guuey-date-input>

        <vaadin-combo-box
          label="coordinator"
          items="[[userList]]"
          value="{{goalData.coordinator}}">
        </vaadin-combo-box>

      </div>

      <div
      class="detailDescription"
      style="background-image:url(../../../../images/target_goals.png">
        <div class="descriptionContainer">
          <paper-input
            label="Goal Description"
            value="{{goalData.description}}"
            required
            auto-validate
            pattern="[a-zA-Z\s\.\d]*"
            error-message="Please enter a description without special characters.">
          </paper-input>
        </div>
      </div>

      <div class="guuey-table">

        <p class="tableScrollLabel">
          swipe left scrolls table
        </p>

        <table>
          <thead>
            <tr>
              <th>
                Step #
              </th>
              <th>
                Description
              </th>
              <th>
                Completed?
              </th>
              <th>
                Edit
              </th>
            </tr>
          </thead>
          <tbody>
            <template
              is="dom-repeat"
              items="{{stepsData}}"
              as="step"
              sort="_sortSteps"
              observe="order description">
              <tr>
                <td>
                  <center>
                    <paper-fab label="[[step.order]]"></paper-fab>
                  </center>
                </td>
                <td>
                  <paper-input value="{{step.description}}"></paper-input>
                </td>
                <td>
                  <paper-checkbox
                    on-change="checkboxChanged"
                    checked="{{step.completed}}">
                  </paper-checkbox>

                </td>
                <td>
                  <paper-icon-button icon="editor:border-color" class="editButton" on-tap="editStep">edit</paper-icon-button>
                </td>
              </tr>
            </template>
            <tr>
              <td>
                <center>
                  <paper-fab icon="icons:add" on-tap="addStep"></paper-fab>
                </center>
              </td>
              <td>
                Add a new step.
              </td>
              <td>
                <paper-checkbox disabled checked></paper-checkbox>
              </td>
              <td>
                <paper-icon-button disabled icon="editor:border-color" class="editButton" on-tap="editStep">edit</paper-icon-button>
              </td>
            </tr>
          </tbody>
        </table>

      </div>

    </paper-card>

  </template>

  <script>

    Polymer({

      is:"su-goals-edit-view",
      properties:{
        goalData:{
          type:Object,
          notify:true
        },
        userList:{
          type:Array
        },
        goalTypes:{
          type:Array,
          value:[
            "Accommodation",
            "Finance And Budget",
            "Social Skills",
            "Medical Treatment",
            "Mental Health",
            "Other"
          ]
        },
        stepModalOpen:{
          type:String,
          notify:true,
          observer:"_stepModalCheck"
        },
        stepId:{
          type:String,
          notify:true
        },
        stepsData:{
          type:Array,
          notify:true
        },
        stepData:{
          type:Object,
          notify:true
        },
        viewType:{
          type:String,
          value:"edit-view"
        }
      },
      behaviors:[
        Polymer.editViewResizeBehavior,
        Polymer.multiEditAnimationBehavior
      ],
      addStep:function(){
        this.fire("addStep");
      },
      editStep:function(e){
        this.stepId=e.model.step.$key;
        this.fire("editStep");
      },
      saveStep:function(){
        this.fire("saveStep");
      },
      cancelStep:function(){
        this.stepModalOpen="close";
      },
      _stepModalCheck:function(state){
        if(state==="close"){
          this.$.stepModal.close();
        } else if(state="open"){
          this.$.stepModal.open();
        };
      },
      checkboxChanged:function(e){
        var checkBool=e.model.step.completed;
        var stepID=e.model.step.$key;
        this.fire("checkboxChanged", {checkBool:checkBool, stepID:stepID});
      },
      _computeGoalImage:function(cat){
        switch(cat) {
          case "Accommodation":
              return "images/goals/accommodation.png"
              break;
          case "Finance And Budget":
              return "images/goals/financeAndBudget.png"
              break;
          case "Social Skills":
              return "images/goals/socialSkills.png"
              break;
          case "Medical Treatment":
              return "images/goals/medicalTreatment.png"
              break;
          case "Mental Health":
              return "images/goals/mentalHealth.png"
              break;
          default:
              return "images/goals/other.png"
        };
      },
      //function to sort steps based on order
      _sortSteps:function(a, b){
        if (a.order === b.order) return 0;
        return a.order < b.order ? -1 : 1;
      },
    });

  </script>

</dom-module>
