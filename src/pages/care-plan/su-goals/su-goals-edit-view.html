<link rel="import" href="../../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../../bower_components/paper-checkbox/paper-checkbox.html" />
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../../bower_components/iron-icons/editor-icons.html" />
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html" />
<link rel="import" href="../../../../bower_components/iron-collapse/iron-collapse.html" />


<!--temp animations till hero animations work-->
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-up-animation.html" />
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-down-animation.html" />

<link rel="import" href="../../../elements/guuey-date-input/guuey-date-input.html" />
<link rel="import" href="../../../elements/media-queries/media-queries.html">

<link rel="import" href="../../../styles/common-styles.html" />

<link rel="import" href="../../../behaviors/edit-view-resize-behavior.html" />
<link rel="import" href="../../../behaviors/multi-edit-animation-behavior.html" />

<dom-module id="su-goals-edit-view">

  <template>

    <media-queries dimensions="{{dimensions}}"></media-queries>

    <style include="common-styles">
      .detailDescription{
        background-color:#4DB6AC;
        width:100%;
        height:150px;
        background-repeat:no-repeat;
        background-size:150px 150px;
        background-position:bottom left;
        margin: 0 0 20px 0;
      }
      .descriptionViewText{
        color:#FFFFFF;
        font-size:20px;
        padding:20px;
      }
      .descriptionViewText:hover{
        cursor:pointer;
        opacity:.8;
      }
      .descriptionEditInput{
        --paper-input-container-color:#FFFFFF;
        --paper-input-container-input-color:#FFFFFF;
      }
      /* new styles */
      .topEditCard{
        width:calc(100% - 40px);
        margin:20px;
        --paper-card-header-image:{
          width:150px;
          float:right;
        };
        --paper-card-header:{
          background-color:var(--category-background-color);
        };
        --paper-card-header-color:#FFFFFF;
      }
      .topEditCategory{

      }
      .guuey-table{
        width:100%;
        padding:0;
        display:block;
      }
      .guuey-table table{
        padding:0;
      }
      .guuey-table paper-fab{
        float:left;
      }
      #descriptionView{
        display:flex;
        flex-direction:row;
        align-items:center;
        width:calc(100% - 160px);
        float:right;
        height:100%;
      }
      #descriptionEdit{
        display:flex;
        flex-direction:row;
        align-items:center;
        width:calc(100% - 160px);
        float:right;
        height:100%;
      }
      #descriptionEdit paper-input{
        width: calc(100% - 10px);
      }
      #descriptionEditButton{
        color:#FFFFFF;
      }
      .stepNumber{
        background-color:#F76363;
      }
    </style>

    <paper-dialog id="stepModal" class="guuey-modal guuey-add-modal">
      <h2>Add/update Step</h2>
      <paper-input
        label="describe the step"
        value="{{stepData.description}}"
        required
        auto-validate
        pattern="[a-zA-Z\s\.!\d]*"
        error-message="Please describe the step."
        allow-custom-value="false">
      </paper-input>
      <vaadin-combo-box
        label="step number"
        items="[[stepOptions]]"
        value="{{stepData.order}}"
        required
        auto-validate
        error-message="Please enter a step from 1 to 9">
      </vaadin-combo-box>
      <div class="modal-button-container">
        <paper-button on-tap="cancelStep">cancel</paper-button>
        <paper-button on-tap="saveStep">save</paper-button>
      </div>
    </paper-dialog>

    <paper-card elevation="3" class="editViewCard">

      <paper-card image="[[_computeGoalImage(goalData.category)]]" heading="[[goalData.category]]" class="topEditCard">
        <div class="card-content">
          <guuey-date-input
            value="{{goalData.startDate}}"
            label="Start Date">
          </guuey-date-input>

          <guuey-date-input
            value="{{goalData.finishDate}}"
            label="Estimated Finish Date">
          </guuey-date-input>

          <vaadin-combo-box
            label="coordinator"
            items="[[userList]]"
            value="{{goalData.coordinator}}">
          </vaadin-combo-box>
        </div>


      </paper-card>

      <div class="inputContainer padded">

        <div
        class="detailDescription"
        style="background-image:url(../../../../images/target_goals.png">
          <iron-collapse opened on-tap="_toggleCollapses" id="descriptionView" horizontal>
            <p class="descriptionViewText">
              [[goalData.description]]
            </p>
          </iron-collapse>

          <iron-collapse id=descriptionEdit horizontal>
            <paper-icon-button id="descriptionEditButton" on-tap="_toggleCollapses" icon="icons:close"></paper-icon-button>
            <paper-input
              label="Goal Description"
              value="{{goalData.description}}"
              required
              auto-validate
              pattern="[a-zA-Z\s\.\d]*"
              error-message="Please enter a description without special characters."
              class="descriptionEditInput">
            </paper-input>
          </iron-collapse>
        </div>

        <div class="guuey-table">

          <p class="tableScrollLabel">
            swipe left scrolls table
          </p>

          <table>
            <thead>
              <tr>
                <th>
                  Step #
                </th>
                <th>
                  Description
                </th>
                <th>
                  Completed?
                </th>
                <th>
                  Edit
                </th>
              </tr>
            </thead>
            <tbody>
              <template
                is="dom-repeat"
                items="{{stepsData}}"
                as="step"
                sort="_sortSteps"
                observe="order description">
                <tr>
                  <td>
                    <center>
                      <paper-fab class="stepNumber" label="[[step.order]]"></paper-fab>
                    </center>
                  </td>
                  <td>
                    <paper-input value="{{step.description}}"></paper-input>
                  </td>
                  <td>
                    <paper-checkbox
                      on-change="checkboxChanged"
                      checked="{{step.completed}}">
                    </paper-checkbox>

                  </td>
                  <td>
                    <paper-icon-button icon="editor:border-color" class="editButton" on-tap="editStep">edit</paper-icon-button>
                  </td>
                </tr>
              </template>
              <tr>
                <td>
                  <center>
                    <paper-fab icon="icons:add" on-tap="addStep"></paper-fab>
                  </center>
                </td>
                <td>
                  Add a new step.
                </td>
                <td>
                  <paper-checkbox disabled checked></paper-checkbox>
                </td>
                <td>
                  <paper-icon-button disabled icon="editor:border-color" class="editButton" on-tap="editStep">edit</paper-icon-button>
                </td>
              </tr>
            </tbody>
          </table>

        </div>

      </div>

    </paper-card>

  </template>

  <script>

    Polymer({

      is:"su-goals-edit-view",
      properties:{
        goalData:{
          type:Object,
          notify:true
        },
        userList:{
          type:Array
        },
        goalTypes:{
          type:Array,
          value:[
            "Accommodation",
            "Finance And Budget",
            "Social Skills",
            "Medical Treatment",
            "Mental Health",
            "Other"
          ]
        },
        stepModalOpen:{
          type:String,
          notify:true,
          observer:"_stepModalCheck"
        },
        stepId:{
          type:String,
          notify:true
        },
        stepsData:{
          type:Array,
          notify:true
        },
        stepData:{
          type:Object,
          notify:true
        },
        viewType:{
          type:String,
          value:"edit-view"
        },
        stepOptions:{
          type:Array,
          value:[
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9"
          ]
        }
      },
      behaviors:[
        Polymer.editViewResizeBehavior,
        Polymer.multiEditAnimationBehavior
      ],
      addStep:function(){
        this.fire("addStep");
      },
      editStep:function(e){
        this.stepId=e.model.step.$key;
        this.fire("editStep");
      },
      saveStep:function(){
        this.fire("saveStep");
      },
      cancelStep:function(){
        this.stepModalOpen="close";
      },
      _stepModalCheck:function(state){
        if(state==="close"){
          this.$.stepModal.close();
        } else if(state="open"){
          this.$.stepModal.open();
        };
      },
      checkboxChanged:function(e){
        var checkBool=e.model.step.completed;
        var stepID=e.model.step.$key;
        this.fire("checkboxChanged", {checkBool:checkBool, stepID:stepID});
      },
      _computeGoalImage:function(cat){
        switch(cat) {
          case "Accommodation":
              this.customStyle["--category-background-color"] = "#ffd600";
              this.updateStyles();
              return "/images/goals/accommodation.png";
              break;
          case "Finance And Budget":
              this.customStyle["--category-background-color"] = "#4db6ac";
              this.updateStyles();
              return "/images/goals/financeAndBudget.png";
              break;
          case "Social Skills":
            this.customStyle["--category-background-color"] = "#2196f3";
            this.updateStyles();
              return "/images/goals/socialSkills.png";
              break;
          case "Medical Treatment":
              this.customStyle["--category-background-color"] = "#00bcd4";
              this.updateStyles();
              return "/images/goals/medicalTreatment.png";
              break;
          case "Mental Health":
              this.customStyle["--category-background-color"] = "#ff8a65";
              this.updateStyles();
              return "/images/goals/mentalHealth.png";
              break;
          default:
              this.customStyle["--category-background-color"] = "#b39ddb";
              this.updateStyles();
              return "/images/goals/other.png";
              break;
        };
      },
      //function to sort steps based on order
      _sortSteps:function(a, b){
        if (a.order === b.order) return 0;
        return a.order < b.order ? -1 : 1;
      },
      _toggleCollapses:function(){
        this.$.descriptionView.toggle();
        this.$.descriptionView.notifyResize();
        this.$.descriptionEdit.toggle();
        this.$.descriptionEdit.notifyResize();
      }
    });

  </script>

</dom-module>
