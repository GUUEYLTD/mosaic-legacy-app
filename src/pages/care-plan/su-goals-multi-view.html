<link rel="import" href="../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../bower_components/paper-progress/paper-progress.html" />
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../../../bower_components/paper-fab/paper-fab.html" />
<link rel="import" href="../../../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../../../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html" />

<!--temp animations till hero animations work-->
<link rel="import" href="../../../bower_components/neon-animation/animations/scale-up-animation.html" />
<link rel="import" href="../../../bower_components/neon-animation/animations/scale-down-animation.html" />

<link rel="import" href="../../elements/media-queries/media-queries.html" />
<link rel="import" href="../../elements/guuey-truncate/guuey-truncate.html" />

<link rel="import" href="../../behaviors/multi-view-resize-behavior.html" />
<link rel="import" href="../../behaviors/multi-edit-animation-behavior.html" />
<link rel="import" href="../../behaviors/multi-view-grid-behavior.html" />
<link rel="import" href="../../behaviors/guuey-dialog-resize-behavior.html" />

<link rel="import" href="../../styles/common-styles.html" />

<dom-module id="su-goals-multi-view">

  <template>

    <media-queries
      dimensions="{{dimensions}}">
    </media-queries>

    <style include="common-styles">
      :host {
        --app-grid-columns:3;
        --app-grid-gutter:20px;
      }

      .goalProgress {
        width:100%;
      }

      .stepsFab {
        background-color:#F76363;
      }

      .stepsFab:hover {
        cursor:default;
      }

      .goalStepsText {
        padding-left:20px;
      }

      .flexRow {
        display:flex;
        flex-direction:row;
        align-items:center;
        height:75px;
      }

      flexRow * {
        vertical-align:middle;
      }

    </style>

    <paper-dialog horizontal-align="left" vertical-align="top" id="editModal">
      <paper-button on-tap="editGoal">edit</paper-button>
      <br />
      <paper-button on-tap="deleteGoal">delete</paper-button>
    </paper-dialog>

    <paper-card class="multiViewCard app-grid">
      <template
        strip-whitespace
        id="domRepeat"
        is="dom-repeat"
        items="[[goalsData]]"
        as="goal">

        <paper-card class="multiItem">
          <div style="background-image:url(../../../../{{_computeGoalImage(goal.category)}})" class="multiCardHeading">
            <p on-tap="directEditModal" class="multiCardLabel">
              <template is="dom-repeat" items="[[computeDisplayCat(goal.category)]]" as="goalEl">

                [[goalEl]]

              </template>
            </p>
          </div>
          <div class="multiCardContainer">
            <p class="multiCardMain">
              <guuey-truncate>[[goal.description]]</guuey-truncate>
            </p>
            <div class="multiCardSecondary">
                <paper-progress
                  class="goalProgress"
                  min="0"
                  max="{{_computeSteps(goal.steps)}}"
                  value="{{_computeCompleteSteps(goal.steps)}}">
                </paper-progress>

                <div class="flexRow">
                  <paper-fab
                    label="{{_computeSteps(goal.steps)}}"
                    class="stepsFab">
                  </paper-fab>

                  <p class="goalStepsText">
                    STEPS
                  </p>
                </div>

            </div>
          </div>

          <paper-icon-button
            icon="icons:more-vert"
            class="multiCardMore"
            on-tap="toggleEditModal">
          </paper-icon-button>

        </paper-card>

      </template>
    </paper-card>

  </template>

  <script>

    Polymer({

      is:"su-goals-multi-view",

      ready: function() {
        this.addEventListener("truncate-read-more", this._readMore);
      },

      properties: {

        dimensions: {
          type: Object
        },

        goalsData: {
          type: Array,
          notify: true,
        },

        goalId: {
          type: String,
          notify: true
        },

        viewType: {
          type: String,
          value: "multi-view"
        }

      },

      behaviors: [
        Polymer.multiViewResizeBehavior,
        //Polymer.multiEditAnimationBehavior,
        Polymer.multiViewGridBehavior,
        Polymer.guueyDialogResizeBehavior
      ],

      editGoal: function(e) {
        this.fire("editGoal");
        this.$.editModal.toggle();
      },

      deleteGoal: function() {
        this.fire("deleteGoal");
        this.$.editModal.toggle();
      },

      _computeGoalImage: function(cat) {
        switch(cat) {
          case "Accommodation":
              return "images/goals/accommodation.png"
              break;
          case "Finance And Budget":
              return "images/goals/financeAndBudget.png"
              break;
          case "Social Skills":
              return "images/goals/socialSkills.png"
              break;
          case "Medical Treatment":
              return "images/goals/medicalTreatment.png"
              break;
          case "Mental Health":
              return "images/goals/mentalHealth.png"
              break;
          default:
              return "images/goals/other.png"
        };
      },

      _computeQueryCount: function(goal) {
        if(!this.queryCount) {
          this.queryCount = 0;
        };
        this.queryCount++;
      },

      _computeCompleteSteps: function(steps) {
        var completeCount = 0;
        for(x in steps) {
          if(steps[x].completed) {
            if(steps[x].completed === true) {
              completeCount++;
            };
          };
        };
        return completeCount;
      },

      _computeSteps: function(steps) {
        var stepCount = 0;
        for(x in steps) {
          stepCount++;
        };
        return stepCount;
      },

      toggleEditModal: function(e) {
        this.$.editModal.positionTarget = e.target;
        this.goalId = e.model.goal.$key;
        this.$.editModal.toggle();
      },

      directEditModal: function(e) {
        this.goalId = e.model.goal.$key;
        this.fire("editGoal");
      },

      computeDisplayCat: function(goal) {
        if(goal.indexOf("&") != -1){
          var arr = goal.split(" & ");
          arr[0] += " &";
          return arr;
        } else if(goal.indexOf("And") != -1) {
          var arr = goal.split(" And ");
          arr[0] += " &";
          return arr;
        } else if(goal.indexOf("and") != -1) {
          var arr = goal.split(" and ");
          arr[0] += " &";
          return arr;
        } else {
          var arr = [];
          arr.push(goal);
          return arr;
        };
      },

      _readMore: function(e) {
        this.goalId = this.$.domRepeat.modelForElement(e.path[5]).goal.$key;
        this.fire("editGoal");
      }

    });

  </script>

</dom-module>
