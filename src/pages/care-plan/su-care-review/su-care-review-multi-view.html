<link rel="import" href="../../../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../../../bower_components/paper-card/paper-card.html" />

<!--temp animations till hero animations work-->
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-up-animation.html" />
<link rel="import" href="../../../../bower_components/neon-animation/animations/scale-down-animation.html" />
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html" />

<link rel="import" href="../../../elements/media-queries/media-queries.html" />

<link rel="import" href="../../../behaviors/multi-edit-animation-behavior.html" />
<link rel="import" href="../../../behaviors/multi-view-resize-behavior.html" />

<link rel="import" href="../../../styles/common-styles.html" />

<dom-module id="su-care-review-multi-view">

  <template>

    <media-queries
      dimensions="{{dimensions}}">
    </media-queries>

    <style include="common-styles">
    :host{
      --app-grid-columns:3;
      --app-grid-gutter:20px;
    };
    </style>

    <paper-dialog horizontal-align="left" vertical-align="top" id="editModal">
      <paper-button on-tap="editReview">edit</paper-button>
      <br />
      <paper-button on-tap="deleteReview">delete</paper-button>
    </paper-dialog>

    <paper-card class="multiViewCard app-grid">
      <template
        is="dom-repeat"
        items="{{reviewsData}}"
        as="review"
        sort="_sortReviewDate"
        observe="nextReviewDate">

        <paper-card class="multiItem">
          <div style="background-image:url(../../../../{{_computeReviewImage(review.nextReviewDate)}})" class="multiCardHeading">
            <p on-tap="directEditModal" class="multiCardLabel">
              [[review.name]]
            </p>
          </div>
          <div class="multiCardContainer">
            <p class="multiCardMain">
              [[review.description]]
            </p>
            <div class="multiCardSecondary">
              <iron-icon icon="icons:update"></iron-icon>{{_computeDate(review.nextReviewDate)}}
            </div>
          </div>

          <paper-icon-button
            icon="icons:more-vert"
            class="multiCardMore"
            on-tap="toggleEditModal">
          </paper-icon-button>

        </paper-card>

      </template>
    </paper-card>

  </template>

  <script>

    Polymer({

      is:"su-care-review-multi-view",
      properties:{
        viewType:{
          type:String,
          value:"multi-view"
        },
        reviewsData:{
          type:Object,
          notify:true,
        }
      },
      behaviors:[
        Polymer.multiViewResizeBehavior,
        //Polymer.multiEditAnimationBehavior
      ],
      toggleEditModal:function(e){
        this.$.editModal.positionTarget = e.target;
        this.reviewId=e.model.review.$key;
        this.$.editModal.toggle();
      },
      editReview:function(e){
        this.fire("editReview", {reviewId:this.reviewId})
        this.$.editModal.close();
      },
      deleteReview:function(e){
        this.fire("deleteReview", {reviewId:this.reviewId});
        this.$.editModal.close();
      },
      _sortReviewDate:function(review1, review2){
        var date1=new Date(review1.nextReviewDate).getTime();
        var date2=new Date(review2.nextReviewDate).getTime();
        return date1>date2;
      },
      _computeReviewImage:function(date){
        var date=new Date(date).getMonth();
        switch(date) {
          case 0:
              return "images/reviews/01jan.png";
              break;
          case 1:
              return "images/reviews/02feb.png";
              break;
          case 2:
              return "images/reviews/03mar.png";
              break;
          case 3:
              return "images/reviews/04apr.png";
              break;
          case 4:
              return "images/reviews/05may.png";
              break;
          case 5:
              return "images/reviews/06jun.png";
              break;
          case 6:
              return "images/reviews/07jul.png";
              break;
          case 7:
              return "images/reviews/08aug.png";
              break;
          case 8:
              return "images/reviews/09sep.png";
              break;
          case 9:
              return "images/reviews/10oct.png";
              break;
          case 10:
              return "images/reviews/11nov.png";
              break;
          case 11:
              return "images/reviews/12dec.png";
              break;
          default:
              return "images/reviews/other.png";
              break;
        };
      },
      _computeDate:function(date){
        if(typeof date==="string"){
          return date.slice(3,15);
        } else {
          return "Date not set";
        };
      },
      directEditModal:function(e){
        this.reviewId=e.model.review.$key;
        this.fire("editReview", {reviewId:this.reviewId});
      },
    });

  </script>

</dom-module>
