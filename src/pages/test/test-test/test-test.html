<link rel="import" href="dependencies.html" />
<dom-module id="test-test">
  <template>

    <firebase-storage
      id="pdf"
      app-name="main"
      path="/uploads"
      url={{pdfURL}}>
    </firebase-storage>

    <firebase-document
      id="fileLocDB"
      app-name="main">
    </firebase-document>
    <firebase-query
      id="uploadsDB"
      app-name="main"
      path="homes/[[home]]/patients/[[patient]]/uploads"
      data={{uploadsData}}>
    </firebase-query>



    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

    <div class="card">
      <h1>file uploads</h1>

      <button on-tap="openDialog">Upload File</button>
      <input type="file" id="fileInput" on-change="fileChange">

      <template is="dom-repeat" items="{{uploadsData}}" as="upload">

        <h1>a file</h1>

        <embed
          src="[[upload.location]]"
          width="100%"
          height="500px"
          type='application/pdf'>

      </template>

    </div>

  </div>
  </template>
  <script>
    Polymer({
      is: 'test-test',
      ready:function(){
        this.fire("pageLoaded",{page:"test-test"});
      },
      properties:{

      },
      observers:[

      ],
      fileChange:function(e) {
        var file = e.target.files[0];
        this.uploadedFile=file;
        this.$.pdf._uploadFile(file)
        .then(function(fileLoc) {
          //save the location to the firebase reg db...
          var path="/homes/"+this.home+"/patients/"+this.patient+"/uploads";
            this.$.fileLocDB.data={
            location:fileLoc
          }
          this.$.fileLocDB.save(path,null);
          console.log(fileLoc);
        }.bind(this))
        .catch(function(error){
          console.log(error);
        });
      },
      renderPDF:function(){
        this.pdfURL=this.$.pdf._downloadFile('/test/Integration_Guide.pdf');
      }
    });
  </script>
</dom-module>
